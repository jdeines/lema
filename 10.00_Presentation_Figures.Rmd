---
title: "Presentation Figures"
author: "Jill Deines"
date: "November 30, 2017"
output: 
  html_document:
    toc: yes
---

Goal: make figures for AGU 2017 presentation

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.path='figure/10.00_PresFigs/',
                      cache = TRUE, cache.path='cache/10.00_PresFigs/')
```

**R Packages Needed**

```{r packages, warning=FALSE, message=FALSE}
library(raster)

library(grid)
library(colorRamps)
library(fields)
library(RColorBrewer)
#library(latticeExtra)
library(viridis)
#library(rasterVis)

#library(devtools)
#install_github("jdeines/salustools")
library(salustools) # for nqblack ggplot theme

library(tidyverse)
library(lubridate)
```

**Directories**

```{r dirs}
resultsDir <- 'C:/Users/deinesji/Dropbox/1PhdJill/hpa/LEMAs/data/salus/experiments/5_LEMA_hist_fixed_v03/results/maps'
```

# Water Levels

## Sheridan Water Level Changes

```{r process_waterlevels}
wlDir <- 'C:/Users/deinesji/Dropbox/1PhdJill/hpa/LEMAs/data/waterLevels_Haacker'

# load just Sheridan and the GMD with hole
masterDF <- read_csv(paste0(wlDir,'/20171209_Combined_wt_vol.csv')) %>%
  #filter(region != 'GMD4') %>%
  filter(Year > 2001) 
```


## HPA Depletion

```{r hpa_depletion}
wlDir <- 'C:/Users/deinesji/Dropbox/1PhdJill/hpa/LEMAs/data/waterLevels_Haacker'
decline <- raster(paste0(wlDir,'/percent_decline_3m_sat_thick_set_100_clip.img'))

# col ramps
# blue and red color ramps pulled from color brewer (no white)
redRamp2 <- colorRampPalette(c('#fddbc7','#f4a582','#d6604d','#b2182b','#67001f'))
blueRamp2 <- colorRampPalette(rev(c('#d1e5f0','#92c5de','#4393c3','#2166ac','#053061')))

colorbreaks <- 200
biPal <- c(blueRamp2(colorbreaks/2),redRamp2(colorbreaks/2))

# scale range
palMin <- -.6
palMax <- .6 

spplot(decline, col.regions=(biPal))

       
# without borders
spplot(freq2, col.regions = c(backgroundcolor,matlab), maxpixels = 2000000,
       sp.layout=list(scale, text1, text2), #, arrow), 
       par.settings=list(axis.line=list(col=NA)), 
       #scales = list(draw=T),
       colorkey=F)#list(labels=list(cex=1.2),
                  #at = c(0:18))




#levelplot(freq2, col.regions=c(backgroundcolor,matlab), axes=F)

# color ramp
image.plot(z=0:18,add=F,legend.only=T,  col=c(backgroundcolor,matlab), 
           horizontal = T,
          smallplot=c(0.05,.95,.15,.2), 
         axis.args=list(at=c(0,3,6,9,12,15,18), 
                          labels=as.character(c(0,3,6,9,12,15,18))))
```


# SALUS Output

## Irrigation Maps by Year

```{r irrMaps}
# load irr rasters
load(paste0(resultsDir, '/All_Irr_Rch_precip_stacks.RData'))
```

## irrigation volume

```{r irrWater}
irrigationSummary <- read_csv(paste0(resultsDir,
                                     '/irrigationSummary_salus_wimas_aim.csv'))
irrwater <- irrigationSummary %>% filter(variable == 'irr_km3' & year >= 2006)
ggplot(irrwater, aes(x = year, y = value, color=datasource)) +
  geom_line() + ylab('Irrigation Volume (km^3)') + xlab('') +
  theme_bw()
```


